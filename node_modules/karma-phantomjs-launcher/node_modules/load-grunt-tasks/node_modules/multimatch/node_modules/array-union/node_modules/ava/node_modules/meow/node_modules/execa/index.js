'use strict';
var childProcess = require('child_process');
var crossSpawnAsync = require('cross-spawn-async');
var stripEof = require('strip-eof');
var objectAssign = require('object-assign');
var TEN_MEBIBYTE = 1024 * 1024 * 10;

module.exports = function (cmd, args, opts) {
	return new Promise(function (resolve, reject) {
		opts = objectAssign({
			maxBuffer: TEN_MEBIBYTE
		}, opts);

		var parsed = crossSpawnAsync._parse(cmd, args, opts);

		var handle = function (val) {
			if (parsed.options.stripEof !=